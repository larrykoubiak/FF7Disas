<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<title>FF7/Kernel/Memory management - QhimmWiki</title>
<meta charset="UTF-8" />
<meta name="generator" content="MediaWiki 1.20.2" />
<link rel="shortcut icon" href="http://wiki.qhimm.com/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="http://wiki.qhimm.com/opensearch_desc.php" title="QhimmWiki (en)" />
<link rel="EditURI" type="application/rsd+xml" href="http://wiki.qhimm.com/api.php?action=rsd" />
<link rel="copyright" href="http://creativecommons.org/licenses/by-nc-sa/2.5/" />
<link rel="alternate" type="application/atom+xml" title="QhimmWiki Atom feed" href="http://wiki.qhimm.com/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="../../../load.php@debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%252Cshared%257Cskins.vector&amp;only=styles&amp;skin=vector&amp;%252A.css" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<style>a:lang(ar),a:lang(ckb),a:lang(fa),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: qhimm_wiki:resourceloader:filter:minify-css:7:9f75cd7a214f5d1850ed6d0df1a4a089 */</style>

<script src="../../../load.php@debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;%252A"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"FF7/Kernel/Memory_management","wgTitle":"FF7/Kernel/Memory management","wgCurRevisionId":3389,"wgArticleId":761,"wgIsArticle":true,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"FF7/Kernel/Memory_management","wgRestrictionEdit":[],"wgRestrictionMove":[]});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function(){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"disablesuggest":0,"editfont":"default","editondblclick":0,"editsection":1,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":0,"extendwatchlist":0,"externaldiff":0,"externaleditor":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"imagesize":2,"justify":0,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nocache":0,"noconvertlink":0,"norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"quickbar":5,"rcdays":7,"rclimit":50,"rememberpassword":0,"rows":25,"searchlimit":20,"showhiddencats":0,"showjumplinks":1,"shownumberswatching":1,"showtoc":1,"showtoolbar":1,"skin":"vector","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":0,"watchdefault":0,"watchdeletion":0,"watchlistdays":3,
"watchlisthideanons":0,"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,"variant":"en","language":"en","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false});;},{},{});mw.loader.implement("user.tokens",function(){mw.user.tokens.set({"editToken":"+\\","watchToken":false});;},{},{});
/* cache key: qhimm_wiki:resourceloader:filter:minify-js:7:7330ebaa3a8da3f7992caf476ddb8efd */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax"]);
}</script>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/vector/csshover.min.htc")}</style><![endif]--></head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-FF7_Kernel_Memory_management skin-vector action-view vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<!-- content -->
		<div id="content" class="mw-body">
			<a id="top"></a>
			<div id="mw-js-message" style="display:none;"></div>
						<!-- firstHeading -->
			<h1 id="firstHeading" class="firstHeading"><span dir="auto">FF7/Kernel/Memory management</span></h1>
			<!-- /firstHeading -->
			<!-- bodyContent -->
			<div id="bodyContent">
								<!-- tagline -->
				<div id="siteSub">From QhimmWiki</div>
				<!-- /tagline -->
								<!-- subtitle -->
				<div id="contentSub"><span class="subpages">&lt; <a href="../../FF7.html" title="FF7">FF7</a>&lrm; | <a href="../Kernel.html" title="FF7/Kernel">Kernel</a></span></div>
				<!-- /subtitle -->
																<!-- jumpto -->
				<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="Memory_management.html#mw-head">navigation</a>, 					<a href="Memory_management.html#p-search">search</a>
				</div>
				<!-- /jumpto -->
								<!-- bodycontent -->
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><h2> <span class="mw-headline" id="RAM_management"> RAM management </span></h2>
<p>No matter what module is banked into memory, there is a section of memory 4,340 bytes long (0x10F4 bytes) that is reserved for all the variables for the entire game. This entire image is called the "<a href="../Savemap.html" title="FF7/Savemap">Savemap</a>". When it's time to save a game, this section of memory is copied to non-volatile ram, such as a hard disk or memory card.
</p><p>Within the <a href="../Savemap.html" title="FF7/Savemap">Savemap</a> there are 5 banks of memory that are directly accessible by the <a href="http://wiki.qhimm.com/edit/FF7/Field_script?redlink=1" class="new" title="FF7/Field script (page does not exist)">field scripting language</a>. These can either be accessed 8 bits or 16 bits at a time depending on the field command argument. The following table is basic memory map of the banks and how they relate to the <a href="../Savemap.html" title="FF7/Savemap">Savemap</a>. There is also an allocation for 256 bytes for temporary field variables. These are not used between field files and are not saved.
</p>
<table border="0" cellpadding="3" cellspacing="1" style="background: rgb(0,0,0)" align="center">
<tr>
<th style="background:rgb(204,204,204); width:80px;" align="center"> Offset
</th>
<th style="background:rgb(204,204,204); width:80px;" align="center"> 8 Bit Field Bank
</th>
<th style="background:rgb(204,204,204); width:100px;" align="center"> 16 Bit Filed Bank
</th>
<th style="background:rgb(204,204,204); width:250px;" align="center"> Description
</th></tr>
<tr>
<td style="background:rgb(255,255,255);"> 0x0000
</td>
<td style="background:rgb(255,255,255);" align="center"> N/A
</td>
<td style="background:rgb(255,255,255);" align="center"> N/A
</td>
<td style="background:rgb(255,255,255);"> Beginning of <a href="../Savemap.html" title="FF7/Savemap">Savemap</a>
</td></tr>
<tr>
<td style="background:rgb(152,204,255);"> 0x0BA4
</td>
<td style="background:rgb(152,204,255);" align="center"> 0x1
</td>
<td style="background:rgb(152,204,255);" align="center"> 0x2
</td>
<td style="background:rgb(152,204,255);"> Field Script Bank 1
</td></tr>
<tr>
<td style="background:rgb(152,204,255);"> 0x0CA4
</td>
<td style="background:rgb(152,204,255);" align="center"> 0x3
</td>
<td style="background:rgb(152,204,255);" align="center"> 0x4
</td>
<td style="background:rgb(152,204,255);"> Field Script Bank 2
</td></tr>
<tr>
<td style="background:rgb(152,204,255);"> 0x0DA4
</td>
<td style="background:rgb(152,204,255);" align="center"> 0xB
</td>
<td style="background:rgb(152,204,255);" align="center"> 0xC
</td>
<td style="background:rgb(152,204,255);"> Field Script Bank 3
</td></tr>
<tr>
<td style="background:rgb(152,204,255);"> 0x0EA4
</td>
<td style="background:rgb(152,204,255);" align="center"> 0xD
</td>
<td style="background:rgb(152,204,255);" align="center"> 0xE
</td>
<td style="background:rgb(152,204,255);"> Field Script Bank 4
</td></tr>
<tr>
<td style="background:rgb(152,204,255);"> 0x0FA4
</td>
<td style="background:rgb(152,204,255);" align="center"> 0xF
</td>
<td style="background:rgb(152,204,255);" align="center"> 0x7
</td>
<td style="background:rgb(152,204,255);"> Field Script Bank 5
</td></tr>
<tr>
<td style="background:rgb(255,255,255);"> 0x10F4
</td>
<td style="background:rgb(255,255,255);" align="center"> N/A
</td>
<td style="background:rgb(255,255,255);" align="center"> N/A
</td>
<td style="background:rgb(255,255,255);"> End of <a href="../Savemap.html" title="FF7/Savemap">Savemap</a>
</td></tr></table>
<table border="0" cellpadding="3" cellspacing="1" style="background: rgb(0,0,0)" align="center">
<tr>
<td style="background:rgb(255,255,255); width:80px;"> N/A
</td>
<td style="background:rgb(255,255,255); width:80px;" align="center"> 0x5
</td>
<td style="background:rgb(255,255,255); width:100px;" align="center"> 0x6
</td>
<td style="background:rgb(255,255,255); width:250px;"> Temporary field variables (256 bytes)
</td></tr></table>
<h2> <span class="mw-headline" id="VRAM_management"> VRAM management </span></h2>
<p>The kernel is in charge of allocating, caching, and displaying in Video RAM. In the case of the PSX, port, the Playstation only has 1 megabyte of VRAM which makes this task a little complex. This is alleviated somewhat by using the PSX's VRAM caching system.
</p><p>The PSX video memory can best be seen as a rectangular "surface" made up of 2048x512 pixels. A slight caveat to this model is that the PSX can hold multiple color depths in VRAM at the same time. To make the VRAM a little easier to visualize, This document represents VRAM as a 1024x512 matrix to allow for some color depth in either direction and to minimize some extreme skewing of the video buffers. 
</p><p><br />
The following is a typical state of VRAM during game play.
</p><p><a href="../../File%253AGears_img_3.jpg.html" class="image"><img alt="Gears img 3.jpg" src="../../../images/6/6b/Gears_img_3.jpg" width="511" height="257" /></a>
</p><p>The two game screens on the left side are the video buffer and the back buffer. The patchwork of graphics on the top right are the field graphics for that scene. The bottom row consists of cached graphics and special effects and on right semi-permanent and permanent textures for the game.
</p><p><br />
The following is a schematic representation of VRAM and all it's texture boundaries.
</p><p><a href="../../File%253AGears_img_4.jpg.html" class="image"><img alt="Gears img 4.jpg" src="../../../images/b/b3/Gears_img_4.jpg" width="512" height="256" /></a>
</p><p>Here the sections of VRAM are much more visible. The large cyan areas are the video frame buffers. The PSX uses a standard double page buffer to animate the game. The blank areas above and below the frame buffers are blank to allow for a correct V-sync. The dark blue areas to the right of the frame buffers are when the game plays 24 bit movies. This requires a slightly larger display and the first two texture caches are overwritten. During times in the game where no movies can take place, such as Battle, textures are commonly placed here.
</p><p>The magenta area under the video buffers is the Color Look Up Tables (CLUT). This is where the texture palettes are stored. This also allows the PSX to display multiple color depths at the same time. The red area to the right is extra CLUT space when it is needed and there are no textures cached there.
</p><p>The green area on the right is the permanent menu textures and the yellow is where the menu font is located.
</p><p>All the blank rectangles are the texture cache boundaries. In order of volatility, the top two rows of cache space are overwritten from left to right, and then the bottom rows are overwritten. The textures on the bottom right are barely overwritten except for key places.
</p><p><br />
</p>
<h2> <span class="mw-headline" id="PSX_CD-ROM_management"> PSX CD-ROM management </span></h2>
<p>One of the big rules on PSX development is that direct hardware access is a prohibited. Everything must go through the BIOS or the program will risk being incompatible with later systems. This means not only from PSX to PS2, but also all the trivial hardware revisions as well. This creates a problem for the kernel. During module transitions (for example, going from "Map" to "Battle"), the engine actually "preloads" the next module while the current one is still executing. This loading of data can't be done with a simple open() or read() BIOS syscall. Whenever you enter the BIOS, the rest of the system comes to a screeching halt until it is exited.
</p><p>This problem is solved by the FF7 actually controlling the CD-ROM access itself though faster, low-level BIOS calls. The kernel can only load 8 kilobytes at a time in this "quick mode" In this mode the kernel also only references files by what sector of the CD-ROM the data is located on, not by filename.
</p>
<!-- 
NewPP limit report
Preprocessor visited node count: 10/1000000
Preprocessor generated node count: 16/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key qhimm_wiki:pcache:idhash:761-0!*!0!!*!2!* and timestamp 20160922123645 -->
</div>				<!-- /bodycontent -->
								<!-- printfooter -->
				<div class="printfooter">
				Retrieved from "<a href="http://wiki.qhimm.com/index.php?title=FF7/Kernel/Memory_management&amp;oldid=3389">http://wiki.qhimm.com/index.php?title=FF7/Kernel/Memory_management&amp;oldid=3389</a>"				</div>
				<!-- /printfooter -->
												<!-- catlinks -->
				<div id='catlinks' class='catlinks catlinks-allhidden'></div>				<!-- /catlinks -->
												<div class="visualClear"></div>
				<!-- debughtml -->
								<!-- /debughtml -->
			</div>
			<!-- /bodyContent -->
		</div>
		<!-- /content -->
		<!-- header -->
		<div id="mw-head" class="noprint">
			
<!-- 0 -->
<div id="p-personal" class="">
	<h5>Personal tools</h5>
	<ul>
		<li id="pt-login"><a href="http://wiki.qhimm.com/index.php?title=Special:UserLogin&amp;returnto=FF7%2FKernel%2FMemory+management" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
	</ul>
</div>

<!-- /0 -->
			<div id="left-navigation">
				
<!-- 0 -->
<div id="p-namespaces" class="vectorTabs">
	<h5>Namespaces</h5>
	<ul>
					<li  id="ca-nstab-main" class="selected"><span><a href="Memory_management.html"  title="View the content page [c]" accesskey="c">Page</a></span></li>
					<li  id="ca-talk" class="new"><span><a href="http://wiki.qhimm.com/edit/Talk:FF7/Kernel/Memory_management?redlink=1"  title="Discussion about the content page [t]" accesskey="t">Discussion</a></span></li>
			</ul>
</div>

<!-- /0 -->

<!-- 1 -->
<div id="p-variants" class="vectorMenu emptyPortlet">
	<h4>
		</h4>
	<h5><span>Variants</span><a href="Memory_management.html#"></a></h5>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>

<!-- /1 -->
			</div>
			<div id="right-navigation">
				
<!-- 0 -->
<div id="p-views" class="vectorTabs">
	<h5>Views</h5>
	<ul>
					<li id="ca-view" class="selected"><span><a href="Memory_management.html" >Read</a></span></li>
					<li id="ca-viewsource"><span><a href="http://wiki.qhimm.com/edit/FF7/Kernel/Memory_management"  title="This page is protected.&#13;&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
					<li id="ca-history" class="collapsible"><span><a href="http://wiki.qhimm.com/history/FF7/Kernel/Memory_management"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
			</ul>
</div>

<!-- /0 -->

<!-- 1 -->
<div id="p-cactions" class="vectorMenu emptyPortlet">
	<h5><span>Actions</span><a href="Memory_management.html#"></a></h5>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>

<!-- /1 -->

<!-- 2 -->
<div id="p-search">
	<h5><label for="searchInput">Search</label></h5>
	<form action="http://wiki.qhimm.com/index.php" id="searchform">
				<div>
			<input type="search" name="search" title="Search QhimmWiki [f]" accesskey="f" id="searchInput" />			<input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchGoButton" class="searchButton" />			<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton" />					<input type='hidden' name="title" value="Special:Search"/>
		</div>
	</form>
</div>

<!-- /2 -->
			</div>
		</div>
		<!-- /header -->
		<!-- panel -->
			<div id="mw-panel" class="noprint">
				<!-- logo -->
					<div id="p-logo"><a style="background-image: url(../../../skins/wiki.png);" href="../../Main_Page.html"  title="Visit the main page"></a></div>
				<!-- /logo -->
				
<!-- navigation -->
<div class="portal" id='p-navigation'>
	<h5>Navigation</h5>
	<div class="body">
		<ul>
			<li id="n-mainpage-description"><a href="../../Main_Page.html" title="Visit the main page [z]" accesskey="z">Main page</a></li>
			<li id="n-portal"><a href="http://wiki.qhimm.com/view/QhimmWiki:Community_portal" title="About the project, what you can do, where to find things">Community portal</a></li>
			<li id="n-currentevents"><a href="http://wiki.qhimm.com/view/QhimmWiki:Current_events" title="Find background information on current events">Current events</a></li>
			<li id="n-recentchanges"><a href="../../Special%253ARecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
			<li id="n-randompage"><a href="../../Special%253ARandom.html" title="Load a random page [x]" accesskey="x">Random page</a></li>
			<li id="n-help"><a href="../../Help%253AContents.html" title="The place to find out">Help</a></li>
		</ul>
	</div>
</div>

<!-- /navigation -->

<!-- SEARCH -->

<!-- /SEARCH -->

<!-- TOOLBOX -->
<div class="portal" id='p-tb'>
	<h5>Toolbox</h5>
	<div class="body">
		<ul>
			<li id="t-whatlinkshere"><a href="../../Special%253AWhatLinksHere/FF7/Kernel/Memory_management.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
			<li id="t-recentchangeslinked"><a href="../../Special%253ARecentChangesLinked/FF7/Kernel/Memory_management.html" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
			<li id="t-specialpages"><a href="../../Special%253ASpecialPages.html" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
			<li id="t-print"><a href="http://wiki.qhimm.com/index.php?title=FF7/Kernel/Memory_management&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
			<li id="t-permalink"><a href="http://wiki.qhimm.com/index.php?title=FF7/Kernel/Memory_management&amp;oldid=3389" title="Permanent link to this revision of the page">Permanent link</a></li>
		</ul>
	</div>
</div>

<!-- /TOOLBOX -->

<!-- LANGUAGES -->

<!-- /LANGUAGES -->
			</div>
		<!-- /panel -->
		<!-- footer -->
		<div id="footer">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> This page was last modified on 18 June 2011, at 05:28.</li>
											<li id="footer-info-viewcount">This page has been accessed 14,493 times.</li>
											<li id="footer-info-copyright">Content is available under <a class="external" href="http://creativecommons.org/licenses/by-nc-sa/2.5/">Attribution-NonCommercial-ShareAlike</a>.</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-privacy"><a href="http://wiki.qhimm.com/view/QhimmWiki:Privacy_policy" title="QhimmWiki:Privacy policy">Privacy policy</a></li>
											<li id="footer-places-about"><a href="http://wiki.qhimm.com/view/QhimmWiki:About" title="QhimmWiki:About">About QhimmWiki</a></li>
											<li id="footer-places-disclaimer"><a href="../../QhimmWiki%253AGeneral_disclaimer.html" title="QhimmWiki:General disclaimer">Disclaimers</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
					<li id="footer-copyrightico">
						<a href="http://creativecommons.org/licenses/by-nc-sa/2.5/"><img src="http://creativecommons.org/images/public/somerights20.gif" alt="Attribution-NonCommercial-ShareAlike" width="88" height="31" /></a>
					</li>
					<li id="footer-poweredbyico">
						<a href="http://www.mediawiki.org/"><img src="../../../skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31" /></a>
					</li>
				</ul>
						<div style="clear:both"></div>
		</div>
		<!-- /footer -->
		<script>if(window.mw){
mw.loader.state({"site":"loading","user":"missing","user.groups":"ready"});
}</script>
<script src="../../../load.php@debug=false&amp;lang=en&amp;modules=skins.vector&amp;only=scripts&amp;skin=vector&amp;%252A"></script>
<script>if(window.mw){
mw.loader.load(["mediawiki.user","mediawiki.page.ready","mediawiki.searchSuggest"], null, true);
}</script>
<script>if(window.mw){
mw.loader.state({"site":"ready"});
}</script>
<!-- Served in 0.153 secs. -->
	</body>
</html>
